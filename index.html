<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Character Fun</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Comic Neue', cursive;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffebee;
            color: #333;
            line-height: 1.6;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .container {
            background-color: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #ff6b6b;
            margin-bottom: 20px;
            text-align: center;
        }
        h1 {
            font-size: 36px;
            text-align: center;
            border-bottom: 4px dotted #ff6b6b;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }
        .character-card {
            border: 3px solid #4ecdc4;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            justify-content: space-between;
            height: 150px;
            cursor: pointer;
        }

        .character-card.expanded {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vw;
            height: auto;
            max-width: 90vw;
            max-height: 90vh;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: auto;
            padding: 20px;
        }

        .character-card.expanded .character {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .character-card.expanded .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .character-card .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        body.card-expanded {
            overflow: hidden;
        }
        
        .character-card:hover {
            transform: translateY(-5px) rotate(3deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .character {
            font-size: 48px;
            color: #333;
            display: inline-block;
            margin-right: 10px;
        }
        .degree {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 18px;
            color: #ff6b6b;
            background-color: #ffe66d;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .degree-title {
            font-size: 28px;
            margin-top: 15px;            
            margin-bottom: 15px;
            color: #ff6b6b;
            text-align: center;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            justify-content: center;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            background-color: #ffe66d;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 18px;
            margin: 0 5px;
            color: #333;
        }
        .tab.active {
            background-color: #ff6b6b;
            color: white;
        }
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .tab-content.active {
            display: block;
        }
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            justify-content: center;
        }
        input[type="text"], textarea, select, input[type="file"], button {
            padding: 12px 20px;
            border: 3px solid #4ecdc4;
            border-radius: 15px;
            font-size: 18px;
            background-color: #fff;
            color: #333;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath fill='%23333' d='M0 0l4 4 4-4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            padding-right: 40px;
        }
        input[type="file"] {
            display: none;
        }
        input[type="file"] + label {
            padding: 12px 20px;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            font-size: 18px;
        }
        input[type="file"] + label:hover {
            background-color: #45b7aa;
        }
        textarea {
            width: calc(100% - 46px);
            margin-bottom: 15px;
            max-width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #ff6b6b;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 18px;
            padding: 12px 25px;
        }
        button:hover {
            background-color: #ff5252;
            transform: scale(1.05);
        }
        .summary {
            background-color: #ffe66d;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
            color: #333;
        }
        .notification {
            background-color: #ff9ff3;
            color: #333;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
            text-align: center;
            font-size: 18px;
        }
        .import-export {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        .review-count {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff6b6b;
            color: #fff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 16px;
        }
        .character-card button {
            margin-top: 10px;
            margin-right: 5px;
            padding: 8px 15px;
            font-size: 16px;
        }
        .character-card .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .next-review {
            font-size: 14px;
            color: #666;
        }
        .checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 20px;
            height: 20px;
        }
        @media (max-width: 768px) {
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .character-card {
                padding: 15px;
                height: auto;
            }
            .character {
                font-size: 36px;
            }
            .character-card button {
                padding: 6px 12px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div class="container">
        <h1>Chinese Character SRS</h1>
        
        <div class="summary" id="summary"></div>

        <div class="tabs">
            <div class="tab" onclick="showTab('reviewTab')">Review</div>
            <div class="tab" onclick="showTab('inputTab')">Input</div>
        </div>

        <div id="reviewTab" class="tab-content">
            <h2>Characters Due for Review</h2>
            <div id="reviewList"></div>
        </div>

        <div id="inputTab" class="tab-content">
            <h2>Add New Characters</h2>
            <textarea id="newCharacters" rows="3" placeholder="Enter characters"></textarea>
            <div class="input-row">
                <select id="newDegree">
                    <option value="0">Degree 0</option>
                    <option value="1">Degree 1</option>
                    <option value="2">Degree 2</option>
                    <option value="3">Degree 3</option>
                    <option value="4">Degree 4</option>
                    <option value="5">Degree 5</option>
                    <option value="6">Degree 6</option>
                </select>
                <button onclick="addCharacters()">Add</button>
            </div>

            <h2>Edit Characters</h2>
            <input type="text" id="searchCharacters" placeholder="Search characters" onkeyup="searchCharacters()">
            <div class="input-row">
                <select id="moveToDegree">
                    <option value="0">Degree 0</option>
                    <option value="1">Degree 1</option>
                    <option value="2">Degree 2</option>
                    <option value="3">Degree 3</option>
                    <option value="4">Degree 4</option>
                    <option value="5">Degree 5</option>
                    <option value="6">Degree 6</option>
                </select>
                <button onclick="moveSelectedToDegree()">Move</button>
                <button onclick="deleteSelected()">Delete</button>
            </div>
            <div id="characterList"></div>
        </div>

        <div class="import-export">
            <h2>Import/Export</h2>
            <input type="file" id="importFile" accept=".xlsx,.xls,.csv">
            <button onclick="document.getElementById('importFile').click(); importCharacters()">Import</button>
            <button onclick="exportCharacters()">Export</button>
            <button onclick="clearCharacters()">Clear</button>
        </div>

        <div id="notification" class="notification"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script>
        let characters = JSON.parse(localStorage.getItem('characters')) || [];
        let selectedIndices = [];


        function addCharacters() {
            const newCharsText = document.getElementById('newCharacters').value.trim();
            const newDegree = parseInt(document.getElementById('newDegree').value);
            const today = new Date().toISOString().split('T')[0];

            if (newCharsText) {
                const newChars = newCharsText.split('').filter(char => char.trim() !== '');
                const addedChars = [];
                const duplicates = [];

                newChars.forEach(char => {
                    if (!characters.some(existingChar => existingChar.character === char)) {
                        characters.push({
                            character: char,
                            degree: newDegree,
                            nextReview: getNextReviewDate(newDegree, today),
                            lastReviewed: today
                        });
                        addedChars.push(char);
                    } else {
                        duplicates.push(char);
                    }
                });

                if (addedChars.length > 0) {
                    saveCharacters();
                    displayCharacters();
                    document.getElementById('newCharacters').value = '';
                    showNotification(`Added ${addedChars.length} new character(s): ${addedChars.join(', ')}`, 'success');
                }

                if (duplicates.length > 0) {
                    showNotification(`Skipped ${duplicates.length} duplicate character(s): ${duplicates.join(', ')}`, 'warning');
                }

                if (addedChars.length === 0 && duplicates.length === 0) {
                    showNotification('No new characters to add.', 'info');
                }
            } else {
                showNotification('Please enter some characters to add.', 'warning');
            }
        }

        function getCharactersForReview() {
            const today = new Date().toISOString().split('T')[0];
            return characters.filter(char => char.nextReview <= today);
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            if (tabId === 'reviewTab') {
                displayReviewCharacters();
            } else if (tabId === 'inputTab') {
                displayCharacters();
            }
        }

        function displayReviewCharacters() {
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = '';
            const dueChars = getCharactersForReview();
            
            if (dueChars.length > 0) {
                const grid = document.createElement('div');
                grid.className = 'character-grid';
                grid.innerHTML = dueChars.map((char, index) => createReviewCard(char, index)).join('');
                reviewList.appendChild(grid);
            } else {
                reviewList.innerHTML = '<p>No characters due for review today.</p>';
            }

            document.getElementById('reviewCount').textContent = dueChars.length;
        }

        function createReviewCard(char, index) {
            return `
                <div class="character-card">
                    <input type="checkbox" class="checkbox" onchange="toggleSelection(${index})">
                    <div class="degree">${char.degree}</div>
                    <div class="character">${char.character}</div>
                    <div class="buttons">
                        <button onclick="keepDegree(${index})">K</button>
                        <button onclick="moveToNextDegree(${index})">M</button>
                    </div>
                    <div class="next-review">${char.nextReview}</div>
                </div>
            `;
        }

        function keepDegree(index) {
            const char = getCharactersForReview()[index];
            const today = new Date().toISOString().split('T')[0];
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayReviewCharacters();
            closeAllExpandedCards();
        }

        function moveToNextDegree(index) {
            const char = getCharactersForReview()[index];
            const today = new Date().toISOString().split('T')[0];
            char.degree = Math.min(char.degree + 1, 6);  // Max degree is 6
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayReviewCharacters();
            closeAllExpandedCards();
        }


        function closeAllExpandedCards() {
            const expandedCards = document.querySelectorAll('.character-card.expanded');
            expandedCards.forEach(card => closeExpandedCard(card, new Event('click')));
        }
        
        function displayCharacters() {
            const list = document.getElementById('characterList');
            list.innerHTML = '';
            
            for (let degree = 0; degree <= 6; degree++) {
                const degreeChars = characters.filter(char => char.degree === degree)
                    .sort((a, b) => a.character.localeCompare(b.character)); // Sort characters alphabetically
                if (degreeChars.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'degree-section';
                    section.innerHTML = `
                        <div class="degree-title">Degree ${degree}</div>
                        <div class="character-grid">
                            ${degreeChars.map((char, index) => createCharacterCard(char, characters.indexOf(char))).join('')}
                        </div>
                    `;
                    list.appendChild(section);
                }
            }
            updateSummary();
        }

        function createCharacterCard(char, index, isReviewCard = false) {
            const cardContent = `
                <input type="checkbox" class="checkbox" onchange="toggleSelection(${index}); event.stopPropagation();">
                <div class="degree">${char.degree}</div>
                <div class="character">${char.character}</div>
                <div class="next-review">${char.nextReview}</div>
                <div class="buttons">
                    ${isReviewCard ? `
                        <button onclick="keepDegree(${index}); event.stopPropagation();">K</button>
                        <button onclick="moveToNextDegree(${index}); event.stopPropagation();">M</button>
                    ` : `
                        <button onclick="moveUp(${index}); event.stopPropagation();">U</button>
                        <button onclick="moveDown(${index}); event.stopPropagation();">D</button>
                    `}
                </div>
                <button class="close-btn" onclick="closeExpandedCard(this.parentElement, event)">Ã—</button>
            `;

            const card = document.createElement('div');
            card.className = 'character-card';
            card.innerHTML = cardContent;
            card.onclick = (event) => expandCard(card, event);

            return card;
        }

        function expandCard(card, event) {
            event.stopPropagation();
            card.classList.add('expanded');
            card.querySelector('.close-btn').style.display = 'flex';
            document.getElementById('overlay').style.display = 'block';
            document.body.classList.add('card-expanded');
        }

        function closeExpandedCard(card, event) {
            event.stopPropagation();
            card.classList.remove('expanded');
            card.querySelector('.close-btn').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            document.body.classList.remove('card-expanded');
        }

        document.addEventListener('click', function(event) {
            if (event.target.id === 'overlay') {
                const expandedCard = document.querySelector('.character-card.expanded');
                if (expandedCard) {
                    closeExpandedCard(expandedCard, event);
                }
            }
        });

        function displayReviewCharacters() {
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = '';
            const dueChars = getCharactersForReview();
            
            if (dueChars.length > 0) {
                const grid = document.createElement('div');
                grid.className = 'character-grid';
                dueChars.forEach((char, index) => {
                    grid.appendChild(createCharacterCard(char, index, true));
                });
                reviewList.appendChild(grid);
            } else {
                reviewList.innerHTML = '<p>No characters due for review today.</p>';
            }

            document.getElementById('reviewCount').textContent = dueChars.length;
        }

        function displayCharacters() {
            const list = document.getElementById('characterList');
            list.innerHTML = '';
            
            for (let degree = 0; degree <= 6; degree++) {
                const degreeChars = characters.filter(char => char.degree === degree)
                    .sort((a, b) => a.character.localeCompare(b.character));
                if (degreeChars.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'degree-section';
                    section.innerHTML = `<div class="degree-title">Degree ${degree}</div>`;
                    const grid = document.createElement('div');
                    grid.className = 'character-grid';
                    degreeChars.forEach((char, index) => {
                        grid.appendChild(createCharacterCard(char, characters.indexOf(char)));
                    });
                    section.appendChild(grid);
                    list.appendChild(section);
                }
            }
            updateSummary();
        }

        function handleNewCharactersKeyPress(event) {
            if (event.key === 'Enter') {
                addCharacters();
            }
        }

        function moveUp(index) {
            const char = characters[index];
            const today = new Date().toISOString().split('T')[0];
            char.degree = Math.min(char.degree + 1, 6); // Move up a degree, max is 6
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayCharacters();
        }

        function moveDown(index) {
            const char = characters[index];
            const today = new Date().toISOString().split('T')[0];
            char.degree = Math.max(char.degree - 1, 0); // Move down a degree, min is 0
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayCharacters();
        }

        function updateDegrees(indices, newDegree) {
            const today = new Date().toISOString().split('T')[0];
            characters = characters.map((char, index) => {
                if (indices.includes(index)) {
                    return {
                        ...char,
                        degree: newDegree,
                        nextReview: getNextReviewDate(newDegree, today),
                        lastReviewed: today
                    };
                }
                return char;
            });
            saveCharacters();
            displayCharacters();
            selectedIndices = [];
            showNotification('Characters updated successfully!', 'success');
        }

        function getNextReviewDate(degree, lastReviewDate) {
            const days = [1, 2, 4, 7, 15, 30, 90][degree];
            const date = new Date(lastReviewDate);
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }

        function toggleSelection(index) {
            const i = selectedIndices.indexOf(index);
            if (i > -1) {
                selectedIndices.splice(i, 1);
            } else {
                selectedIndices.push(index);
            }
        }

        function moveSelectedToDegree() {
            const degree = parseInt(document.getElementById('moveToDegree').value);
            updateDegrees(selectedIndices, degree);
        }

        function updateDegrees(indices, newDegree) {
            const today = new Date().toISOString().split('T')[0];
            characters = characters.map((char, index) => {
                if (indices.includes(index)) {
                    return {
                        ...char,
                        degree: newDegree,
                        nextReview: getNextReviewDate(newDegree),
                        lastReviewed: today
                    };
                }
                return char;
            });
            saveCharacters();
            displayCharacters();
            selectedIndices = [];
            showNotification('Characters updated successfully!', 'success');
        }

        function deleteSelected() {
            characters = characters.filter((_, index) => !selectedIndices.includes(index));
            saveCharacters();
            displayCharacters();
            selectedIndices = [];
            showNotification('Selected characters deleted successfully!', 'success');
        }

        function saveCharacters() {
            localStorage.setItem('characters', JSON.stringify(characters));
        }

        function showNotification(message, type = 'error') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            switch(type) {
                case 'success':
                    notification.style.backgroundColor = '#d4edda';
                    notification.style.color = '#155724';
                    break;
                case 'warning':
                    notification.style.backgroundColor = '#fff3cd';
                    notification.style.color = '#856404';
                    break;
                case 'info':
                    notification.style.backgroundColor = '#d1ecf1';
                    notification.style.color = '#0c5460';
                    break;
                default:
                    notification.style.backgroundColor = '#f8d7da';
                    notification.style.color = '#721c24';
            }
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);  // Display for 5 seconds
        }

        function updateSummary() {
            const totalCharacters = characters.length;
            const today = new Date().toISOString().split('T')[0];
            const dueCharacters = characters.filter(char => char.nextReview <= today).length;
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <strong>Total Characters:</strong> ${totalCharacters} | 
                <strong>Due for Review Today:</strong> ${dueCharacters}
            `;
        }

        function exportCharacters() {
            const ws = XLSX.utils.json_to_sheet(characters.map(char => ({
                character: char.character,
                degree: char.degree,
                nextReview: char.nextReview
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Characters");
            XLSX.writeFile(wb, "chinese_characters_srs.xlsx");
        }

        function importCharacters() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet);
                    
                    const duplicates = [];
                    const newCharacters = json.filter(row => {
                        if (characters.some(char => char.character === row.character)) {
                            duplicates.push(row.character);
                            return false;
                        }
                        return true;
                    }).map(row => ({
                        character: row.character,
                        degree: parseInt(row.degree),
                        nextReview: row.nextReview,
                        lastReviewed: new Date().toISOString().split('T')[0]
                    }));

                    if (newCharacters.length > 0) {
                        characters = [...characters, ...newCharacters];
                        saveCharacters();
                        displayCharacters();
                        showNotification(`Imported ${newCharacters.length} new characters successfully!`, 'success');
                    }

                    if (duplicates.length > 0) {
                        showNotification(`Skipped ${duplicates.length} duplicate characters: ${duplicates.join(', ')}`, 'warning');
                    }

                    if (newCharacters.length === 0 && duplicates.length === 0) {
                        showNotification('No new characters to import.', 'info');
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        }

        function clearCharacters() {
            if (confirm("Are you sure you want to clear all characters? This action cannot be undone.")) {
                characters = [];
                saveCharacters();
                displayCharacters();
                showNotification('All characters have been cleared!', 'success');
            }
        }

        function searchCharacters() {
            const searchTerm = document.getElementById('searchCharacters').value.toLowerCase();
            const characterCards = document.querySelectorAll('.character-card');
            characterCards.forEach(card => {
                const character = card.querySelector('.character').textContent.toLowerCase();
                if (character.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            showTab('reviewTab');
            document.getElementById('newCharacters').addEventListener('keypress', handleNewCharactersKeyPress);
        });

    </script>
</body>
</html>
