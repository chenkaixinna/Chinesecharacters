<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Character SRS</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            color: #212529;
            line-height: 1.6;
        }
        .container {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
            color: #000;
            margin-bottom: 20px;
        }
        h1 {
            font-size: 36px;
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        .character-card {
            border: none;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f8f9fa;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            justify-content: space-between;
            height: 120px;
        }
        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .character {
            font-size: 36px;
            color: #000;
            display: inline-block;
            margin-right: 10px;
        }
        .degree {
            position: absolute;
            top: 5px;
            right: 5px;
            font-family: 'Playfair Display', serif;
            font-size: 14px;
            color: #000;
        }
        .degree-title {
            font-family: 'Playfair Display', serif;
            font-size: 25px;
            vertical-align: middle;
            margin-top: 15px;            
            margin-bottom: 15px;
            color: #000;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            font-family: 'Playfair Display', serif;
            flex: 1;
            text-align: center;
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 14px;
        }
        .tab.active {
            background-color: #000;
            color: white;
        }
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 8px 8px 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .tab-content.active {
            display: block;
        }
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        input[type="text"], textarea, select, input[type="file"], button {
            font-family: 'Playfair Display', serif;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            background-color: #fff;
            color: #000;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath fill='%23000' d='M0 0l4 4 4-4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px;
            padding-right: 30px;
        }
        input[type="file"] {
            display: none;
        }
        input[type="file"] + label {
            font-family: 'Playfair Display', serif;
            padding: 10px 15px;
            background-color: #000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }
        input[type="file"] + label:hover {
            background-color: #343a40;
        }
        textarea {
            width: calc(100% - 1px);
            margin-bottom: 10px;
            max-width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #000;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover {
            background-color: #343a40;
        }
        .summary {
            font-family: 'Playfair Display', serif;
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 16px;
            text-align: center;
        }
        .notification {
            font-family: 'Playfair Display', serif;
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            text-align: center;
        }
        .import-export {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .review-count {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #000;
            color: #fff;
            padding: 5px 10px;
            border-radius: 15px;
            font-family: 'Playfair Display', serif;
        }
        .character-card button {
            margin-top: 10px;
            margin-right: 5px;
            padding: 5px 10px;
            font-size: 12px;
        }
        .character-card .buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .next-review {
            font-size: 12px;
            color: #666;
        }
        .checkbox {
            position: absolute;
            top: 5px;
            left: 5px;
        }
        @media (max-width: 768px) {
            .character-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .character-card {
                padding: 10px;
                height: auto;
            }
            .character {
                font-size: 24px;
            }
            .character-card button {
                padding: 2px 6px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chinese Character SRS</h1>
        
        <div class="summary" id="summary"></div>

        <div class="tabs">
            <div class="tab" onclick="showTab('reviewTab')">Review</div>
            <div class="tab" onclick="showTab('inputTab')">Input</div>
        </div>

        <div id="reviewTab" class="tab-content">
            <h2>Characters Due for Review</h2>
            <div id="reviewList"></div>
        </div>

        <div id="inputTab" class="tab-content">
            <h2>Add New Characters</h2>
            <textarea id="newCharacters" rows="3" placeholder="Enter characters"></textarea>
            <div class="input-row">
                <select id="newDegree">
                    <option value="0">Degree 0</option>
                    <option value="1">Degree 1</option>
                    <option value="2">Degree 2</option>
                    <option value="3">Degree 3</option>
                    <option value="4">Degree 4</option>
                    <option value="5">Degree 5</option>
                    <option value="6">Degree 6</option>
                </select>
                <button onclick="addCharacters()">Add</button>
            </div>

            <h2>Edit Characters</h2>
            <input type="text" id="searchCharacters" placeholder="Search characters" onkeyup="searchCharacters()">
            <div class="input-row">
                <select id="moveToDegree">
                    <option value="0">Degree 0</option>
                    <option value="1">Degree 1</option>
                    <option value="2">Degree 2</option>
                    <option value="3">Degree 3</option>
                    <option value="4">Degree 4</option>
                    <option value="5">Degree 5</option>
                    <option value="6">Degree 6</option>
                </select>
                <button onclick="moveSelectedToDegree()">Move</button>
                <button onclick="deleteSelected()">Delete</button>
            </div>
            <div id="characterList"></div>
        </div>

        <div class="import-export">
            <h2>Import/Export</h2>
            <input type="file" id="importFile" accept=".xlsx,.xls,.csv">
            <button onclick="document.getElementById('importFile').click(); importCharacters()">Import</button>
            <button onclick="exportCharacters()">Export</button>
            <button onclick="clearCharacters()">Clear</button>
        </div>

        <div id="notification" class="notification"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script>
        let characters = JSON.parse(localStorage.getItem('characters')) || [];
        let selectedIndices = [];

        function getCharactersForReview() {
            const today = new Date().toISOString().split('T')[0];
            return characters.filter(char => char.nextReview <= today);
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            if (tabId === 'reviewTab') {
                displayReviewCharacters();
            } else if (tabId === 'inputTab') {
                displayCharacters();
            }
        }

        function displayReviewCharacters() {
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = '';
            const dueChars = getCharactersForReview();
            
            if (dueChars.length > 0) {
                const grid = document.createElement('div');
                grid.className = 'character-grid';
                grid.innerHTML = dueChars.map((char, index) => createReviewCard(char, index)).join('');
                reviewList.appendChild(grid);
            } else {
                reviewList.innerHTML = '<p>No characters due for review today.</p>';
            }

            document.getElementById('reviewCount').textContent = dueChars.length;
        }

        function createReviewCard(char, index) {
            return `
                <div class="character-card">
                    <input type="checkbox" class="checkbox" onchange="toggleSelection(${index})">
                    <div class="degree">${char.degree}</div>
                    <div class="character">${char.character}</div>
                    <div class="buttons">
                        <button onclick="keepDegree(${index})">K</button>
                        <button onclick="moveToNextDegree(${index})">M</button>
                    </div>
                    <div class="next-review">${char.nextReview}</div>
                </div>
            `;
        }

        function keepDegree(index) {
            const char = getCharactersForReview()[index];
            const today = new Date().toISOString().split('T')[0];
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayReviewCharacters();
        }

        function moveToNextDegree(index) {
            const char = getCharactersForReview()[index];
            const today = new Date().toISOString().split('T')[0];
            char.degree = Math.min(char.degree + 1, 6);  // Max degree is 6
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayReviewCharacters();
        }

        function displayCharacters() {
            const list = document.getElementById('characterList');
            list.innerHTML = '';
            
            for (let degree = 0; degree <= 6; degree++) {
                const degreeChars = characters.filter(char => char.degree === degree);
                if (degreeChars.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'degree-section';
                    section.innerHTML = `
                        <div class="degree-title">Degree ${degree}</div>
                        <div class="character-grid">
                            ${degreeChars.map((char, index) => createCharacterCard(char, characters.indexOf(char))).join('')}
                        </div>
                    `;
                    list.appendChild(section);
                }
            }
            updateSummary();
        }

        function createCharacterCard(char, index) {
            return `
                <div class="character-card">
                    <input type="checkbox" class="checkbox" onchange="toggleSelection(${index})">
                    <div class="character">${char.character}</div>
                    <div class="next-review">${char.nextReview}</div>
                    <div class="buttons">
                        <button onclick="moveUp(${index})">U</button>
                        <button onclick="moveDown(${index})">D</button>
                    </div>
                </div>
            `;
        }


        function moveUp(index) {
            const char = characters[index];
            const today = new Date().toISOString().split('T')[0];
            char.degree = Math.min(char.degree + 1, 6); // Move up a degree, max is 6
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayCharacters();
        }

        function moveDown(index) {
            const char = characters[index];
            const today = new Date().toISOString().split('T')[0];
            char.degree = Math.max(char.degree - 1, 0); // Move down a degree, min is 0
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            saveCharacters();
            displayCharacters();
        }

        function updateDegrees(indices, newDegree) {
            const today = new Date().toISOString().split('T')[0];
            characters = characters.map((char, index) => {
                if (indices.includes(index)) {
                    return {
                        ...char,
                        degree: newDegree,
                        nextReview: getNextReviewDate(newDegree, today),
                        lastReviewed: today
                    };
                }
                return char;
            });
            saveCharacters();
            displayCharacters();
            selectedIndices = [];
            showNotification('Characters updated successfully!', 'success');
        }

        function getNextReviewDate(degree, lastReviewDate) {
            const days = [1, 2, 4, 7, 15, 30, 90][degree];
            const date = new Date(lastReviewDate);
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }

        function toggleSelection(index) {
            const i = selectedIndices.indexOf(index);
            if (i > -1) {
                selectedIndices.splice(i, 1);
            } else {
                selectedIndices.push(index);
            }
        }

        function moveSelectedToDegree() {
            const degree = parseInt(document.getElementById('moveToDegree').value);
            updateDegrees(selectedIndices, degree);
        }

        function updateDegrees(indices, newDegree) {
            const today = new Date().toISOString().split('T')[0];
            characters = characters.map((char, index) => {
                if (indices.includes(index)) {
                    return {
                        ...char,
                        degree: newDegree,
                        nextReview: getNextReviewDate(newDegree),
                        lastReviewed: today
                    };
                }
                return char;
            });
            saveCharacters();
            displayCharacters();
            selectedIndices = [];
            showNotification('Characters updated successfully!', 'success');
        }

        function deleteSelected() {
            characters = characters.filter((_, index) => !selectedIndices.includes(index));
            saveCharacters();
            displayCharacters();
            selectedIndices = [];
            showNotification('Selected characters deleted successfully!', 'success');
        }

        function saveCharacters() {
            localStorage.setItem('characters', JSON.stringify(characters));
        }

        function showNotification(message, type = 'error') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            switch(type) {
                case 'success':
                    notification.style.backgroundColor = '#d4edda';
                    notification.style.color = '#155724';
                    break;
                case 'warning':
                    notification.style.backgroundColor = '#fff3cd';
                    notification.style.color = '#856404';
                    break;
                case 'info':
                    notification.style.backgroundColor = '#d1ecf1';
                    notification.style.color = '#0c5460';
                    break;
                default:
                    notification.style.backgroundColor = '#f8d7da';
                    notification.style.color = '#721c24';
            }
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);  // Display for 5 seconds
        }

        function updateSummary() {
            const totalCharacters = characters.length;
            const today = new Date().toISOString().split('T')[0];
            const dueCharacters = characters.filter(char => char.nextReview <= today).length;
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <strong>Total Characters:</strong> ${totalCharacters} | 
                <strong>Due for Review Today:</strong> ${dueCharacters}
            `;
        }

        function exportCharacters() {
            const ws = XLSX.utils.json_to_sheet(characters.map(char => ({
                character: char.character,
                degree: char.degree,
                nextReview: char.nextReview
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Characters");
            XLSX.writeFile(wb, "chinese_characters_srs.xlsx");
        }

        function importCharacters() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet);
                    
                    const duplicates = [];
                    const newCharacters = json.filter(row => {
                        if (characters.some(char => char.character === row.character)) {
                            duplicates.push(row.character);
                            return false;
                        }
                        return true;
                    }).map(row => ({
                        character: row.character,
                        degree: parseInt(row.degree),
                        nextReview: row.nextReview,
                        lastReviewed: new Date().toISOString().split('T')[0]
                    }));

                    if (newCharacters.length > 0) {
                        characters = [...characters, ...newCharacters];
                        saveCharacters();
                        displayCharacters();
                        showNotification(`Imported ${newCharacters.length} new characters successfully!`, 'success');
                    }

                    if (duplicates.length > 0) {
                        showNotification(`Skipped ${duplicates.length} duplicate characters: ${duplicates.join(', ')}`, 'warning');
                    }

                    if (newCharacters.length === 0 && duplicates.length === 0) {
                        showNotification('No new characters to import.', 'info');
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        }

        function clearCharacters() {
            if (confirm("Are you sure you want to clear all characters? This action cannot be undone.")) {
                characters = [];
                saveCharacters();
                displayCharacters();
                showNotification('All characters have been cleared!', 'success');
            }
        }

        function searchCharacters() {
            const searchTerm = document.getElementById('searchCharacters').value.toLowerCase();
            const characterCards = document.querySelectorAll('.character-card');
            characterCards.forEach(card => {
                const character = card.querySelector('.character').textContent.toLowerCase();
                if (character.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            showTab('reviewTab');
        });

    </script>
</body>
</html>
