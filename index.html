<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Character SRS</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Comic Neue', cursive;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffebee;
            color: #333;
            line-height: 1.6;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .container {
            background-color: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #ff6b6b;
            margin-bottom: 20px;
            text-align: center;
        }
        h1 {
            font-size: 36px;
            text-align: center;
            border-bottom: 4px dotted #ff6b6b;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }
        .character-card {
            border: 3px solid #4ecdc4;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            justify-content: space-between;
            height: 150px;
        }
        .character-card:hover {
            transform: translateY(-5px) rotate(3deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .character {
            font-size: 48px;
            color: #333;
            display: inline-block;
            margin-right: 10px;
        }
        .degree {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 18px;
            color: #ff6b6b;
            background-color: #ffe66d;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            justify-content: center;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            background-color: #ffe66d;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 18px;
            margin: 0 5px;
            color: #333;
        }
        .tab.active {
            background-color: #ff6b6b;
            color: white;
        }
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .tab-content.active {
            display: block;
        }
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            justify-content: center;
        }
        input[type="text"], textarea, select, input[type="file"], button {
            padding: 12px 20px;
            border: 3px solid #4ecdc4;
            border-radius: 15px;
            font-size: 18px;
            background-color: #fff;
            color: #333;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cpath fill='%23333' d='M0 0l4 4 4-4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            padding-right: 40px;
        }
        input[type="file"] {
            display: none;
        }
        input[type="file"] + label {
            padding: 12px 20px;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            font-size: 18px;
        }
        input[type="file"] + label:hover {
            background-color: #45b7aa;
        }
        textarea {
            width: calc(100% - 46px);
            margin-bottom: 15px;
            max-width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #ff6b6b;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 18px;
            padding: 12px 25px;
        }
        button:hover {
            background-color: #ff5252;
            transform: scale(1.05);
        }
        .summary {
            background-color: #ffe66d;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
            color: #333;
        }
        .notification {
            background-color: #ff9ff3;
            color: #333;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
            text-align: center;
            font-size: 18px;
        }
        .import-export {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        .review-count {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff6b6b;
            color: #fff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 16px;
        }
        .character-card button {
            margin-top: 10px;
            margin-right: 5px;
            padding: 8px 15px;
            font-size: 16px;
        }
        .character-card .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .next-review {
            font-size: 14px;
            color: #666;
        }
        .checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 20px;
            height: 20px;
        }
        @media (max-width: 768px) {
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .character-card {
                padding: 15px;
                height: auto;
            }
            .character {
                font-size: 36px;
            }
            .character-card button {
                padding: 6px 12px;
                font-size: 14px;
            }
        }
        
        .review-card {
            border: 3px solid #4ecdc4;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; /* For positioning the degree */
        }

        .review-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .review-degree {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ffe66d;
            color: #333;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .review-character {
            font-size: 72px;
            color: #333;
            margin: 30px 0; /* Increased top margin to accommodate the degree */
        }

        .review-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .review-buttons button {
            padding: 8px 16px;
            font-size: 14px;
            min-width: 80px;
            max-width: 100px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .review-buttons button:hover {
            background-color: #ff5252;
        }

        @media (max-width: 480px) {
            .review-character {
                font-size: 60px;
            }

            .review-buttons button {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
        .character-card.placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            background-color: #f0f0f0;
            color: #999;
            font-style: italic;
        }

        .toggleDisplayBtn {
            background-color: #4ecdc4;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggleDisplayBtn:hover {
            background-color: #45b7aa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chinese Character SRS</h1>
        
        <div class="summary" id="summary"></div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('reviewTab')">Review</div>
            <div class="tab" onclick="showTab('inputTab')">Input</div>
        </div>

        <div id="reviewTab" class="tab-content active">
            <h2>Characters Due for Review</h2>
            <div id="reviewList"></div>
        </div>

        <div id="inputTab" class="tab-content">
            <h2>Add New Characters</h2>
            <textarea id="newCharacters" rows="3" placeholder="Enter characters"></textarea>
            <div class="input-row">
                <select id="newDegree">
                    <option value="0">Degree 0</option>
                    <option value="1">Degree 1</option>
                    <option value="2">Degree 2</option>
                    <option value="3">Degree 3</option>
                    <option value="4">Degree 4</option>
                    <option value="5">Degree 5</option>
                </select>
                <select id="newProperty">
                    <option value="">Select Property</option>
                    <option value="noun">Noun</option>
                    <option value="verb">Verb</option>
                    <option value="adj">Adjective</option>
                    <option value="adv">Adverb</option>
                    <option value="quan">Quantifier</option>
                    <option value="num">Numeral</option>
                    <option value="pre">Preposition</option>
                </select>
                <button onclick="addCharacters()">Add</button>
            </div>
        
            <h2>Edit Characters</h2>
            <div class="input-row">
                <button id="toggleDisplayBtn" onclick="toggleDisplay()">Display by: Degrees</button>
                <input type="text" id="searchCharacters" placeholder="Search characters" onkeyup="searchCharacters()">
            </div>
            <div class="input-row">
                <select id="moveToDegree">
                    <option value="0">Degree 0</option>
                    <option value="1">Degree 1</option>
                    <option value="2">Degree 2</option>
                    <option value="3">Degree 3</option>
                    <option value="4">Degree 4</option>
                    <option value="5">Degree 5</option>
                </select>
                <button onclick="moveSelectedToDegree()">Move</button>
                <select id="batchProperty">
                    <option value="">Select Property</option>
                    <option value="noun">Noun</option>
                    <option value="verb">Verb</option>
                    <option value="adj">Adjective</option>
                    <option value="adv">Adverb</option>
                    <option value="quan">Quantifier</option>
                    <option value="num">Numeral</option>
                    <option value="pre">Preposition</option>
                </select>
                <button onclick="applyBatchProperty()">Apply Property</button>
                <button onclick="deleteSelected()">Delete</button>
            </div>
            <div id="characterList"></div>
        </div>

        <div class="import-export">
            <input type="file" id="importFile" accept=".xlsx,.xls,.csv">
            <button onclick="document.getElementById('importFile').click()">Import</button>
            <button onclick="exportCharacters()">Export</button>
            <button onclick="clearCharacters()">Clear</button>
        </div>

        <div id="notification" class="notification"></div>
    </div>

    <script>
        let characters = JSON.parse(localStorage.getItem('characters')) || [];
        let selectedIndices = [];
        let displayMode = 'degrees'; // 'degrees' or 'properties'
        
        function toggleDisplay() {
            displayMode = displayMode === 'degrees' ? 'properties' : 'degrees';
            const toggleBtn = document.getElementById('toggleDisplayBtn');
            toggleBtn.textContent = `Display by: ${displayMode.charAt(0).toUpperCase() + displayMode.slice(1)}`;
            displayCharacters();
        }

        function saveCharacters() {
            localStorage.setItem('characters', JSON.stringify(characters));
        }

        function addCharacters() {
            const newCharsText = document.getElementById('newCharacters').value.trim();
            const newDegree = parseInt(document.getElementById('newDegree').value);
            const newProperty = document.getElementById('newProperty').value; // Make sure this element exists in your HTML
            const today = new Date().toISOString().split('T')[0];
        
            if (newCharsText) {
                const newChars = newCharsText.split('').filter(char => char.trim() !== '');
                const addedChars = [];
                const duplicates = [];
        
                newChars.forEach(char => {
                    if (!characters.some(existingChar => existingChar.character === char)) {
                        characters.push({
                            character: char,
                            degree: newDegree,
                            nextReview: getNextReviewDate(newDegree, today),
                            lastReviewed: today,
                            property: newProperty
                        });
                        addedChars.push(char);
                    } else {
                        duplicates.push(char);
                    }
                });

                if (addedChars.length > 0) {
                    saveCharacters();
                    displayCharacters(); // This now respects the current display mode
                    document.getElementById('newCharacters').value = '';
                    showNotification(`Added ${addedChars.length} new character(s): ${addedChars.join(', ')}`, 'success');
                }

                if (duplicates.length > 0) {
                    showNotification(`Skipped ${duplicates.length} duplicate character(s): ${duplicates.join(', ')}`, 'warning');
                }

                if (addedChars.length === 0 && duplicates.length === 0) {
                    showNotification('No new characters to add.', 'info');
                }
            } else {
                showNotification('Please enter some characters to add.', 'warning');
            }
        }

        function getNextReviewDate(degree, lastReview) {
            const date = new Date(lastReview);
            switch(degree) {
                case 0: return date.toISOString().split('T')[0]; // Today
                case 1: date.setDate(date.getDate() + 1); break; // Tomorrow
                case 2: date.setDate(date.getDate() + 7); break; // 7 days later
                case 3: date.setDate(date.getDate() + 14); break; // 14 days later
                case 4: date.setDate(date.getDate() + 30); break; // 30 days later
                case 5: return '9999-12-31'; // Far future date for "don't review"
            }
            return date.toISOString().split('T')[0];
        }

        function displayCharacters() {
            const list = document.getElementById('characterList');
            list.innerHTML = '';
            
            if (displayMode === 'degrees') {
                displayCharactersByDegrees();
            } else {
                displayCharactersByProperties();
            }
            
            updateSummary();
        }
        
        function displayCharactersByDegrees() {
            const list = document.getElementById('characterList');
            
            for (let degree = 0; degree <= 5; degree++) {
                const degreeChars = characters.filter(char => char.degree === degree);
                const degreeSection = document.createElement('div');
                degreeSection.innerHTML = `<h3>Degree ${degree}</h3>`;
                const degreeGrid = document.createElement('div');
                degreeGrid.className = 'character-grid';
                
                if (degreeChars.length > 0) {
                    degreeChars.forEach((char) => {
                        const card = createCharacterCard(char);
                        degreeGrid.appendChild(card);
                    });
                } else {
                    // Add a placeholder message when there are no characters for this degree
                    const placeholder = document.createElement('div');
                    placeholder.className = 'character-card placeholder';
                    placeholder.textContent = 'No characters in this degree';
                    degreeGrid.appendChild(placeholder);
                }
                
                degreeSection.appendChild(degreeGrid);
                list.appendChild(degreeSection);
            }
        }
        

        
        function displayCharactersByProperties() {
            const list = document.getElementById('characterList');
            const properties = ['noun', 'verb', 'adj', 'adv', 'quan', 'num', 'pre', 'N/A', ''];
            
            properties.forEach(prop => {
                let propChars;
                if (prop === '') {
                    propChars = characters.filter(char => !char.property || char.property.trim() === '');
                } else {
                    propChars = characters.filter(char => char.property === prop);
                }
                
                if (propChars.length > 0) {
                    const propSection = document.createElement('div');
                    propSection.innerHTML = `<h3>${prop ? prop.charAt(0).toUpperCase() + prop.slice(1) : 'No Property'}</h3>`;
                    const propGrid = document.createElement('div');
                    propGrid.className = 'character-grid';
                    
                    propChars.forEach((char) => {
                        const card = createCharacterCard(char);
                        propGrid.appendChild(card);
                    });
                    
                    propSection.appendChild(propGrid);
                    list.appendChild(propSection);
                }
            });
        }
        
        function createCharacterCard(char) {
            const globalIndex = characters.indexOf(char);
            const card = document.createElement('div');
            card.className = 'character-card';
            card.innerHTML = `
                <input type="checkbox" class="checkbox" onchange="toggleSelection(${globalIndex})">
                <div class="degree">${char.degree}</div>
                <div class="character">${char.character}</div>
                <div class="property">${char.property || 'N/A'}</div>
                <div class="buttons">
                    <button onclick="adjustDegree(${globalIndex}, 1)">+</button>
                    <button onclick="adjustDegree(${globalIndex}, -1)">-</button>
                </div>
                <div class="next-review">${char.nextReview}</div>
            `;
            return card;
        }
        function displayReviewCharacters() {
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = '';
            const today = new Date().toISOString().split('T')[0];
            const dueChars = characters.filter(char => char.nextReview <= today);
            
            if (dueChars.length === 0) {
                reviewList.innerHTML = '<p>No characters due for review today.</p>';
            } else {
                dueChars.forEach((char, index) => {
                    const card = document.createElement('div');
                    card.className = 'review-card';
                    card.innerHTML = `
                        <div class="review-degree">Degree ${char.degree}</div>
                        <div class="review-character">${char.character}</div>
                        <div class="review-buttons">
                            <button onclick="reviewCharacter(${index}, 1)">+</button>
                            <button onclick="reviewCharacter(${index}, 0)">0</button>
                            <button onclick="reviewCharacter(${index}, -1)">-</button>
                        </div>
                    `;
                    reviewList.appendChild(card);
                });
            }

            updateSummary();
        }

        function reviewCharacter(index, result) {
            const char = characters[index];
            const today = new Date().toISOString().split('T')[0];
            
            if (result === 1) {
                char.degree = Math.min(5, char.degree + 1);
            } else if (result === -1) {
                char.degree = 0;
            }
            
            char.lastReviewed = today;
            char.nextReview = getNextReviewDate(char.degree, today);
            
            saveCharacters();
            displayReviewCharacters();
        }

        function adjustDegree(index, change) {
            characters[index].degree = Math.max(0, Math.min(5, characters[index].degree + change));
            characters[index].nextReview = getNextReviewDate(characters[index].degree, new Date().toISOString().split('T')[0]);
            saveCharacters();
            displayCharacters();
        }

        function toggleSelection(index) {
            const i = selectedIndices.indexOf(index);
            if (i > -1) {
                selectedIndices.splice(i, 1);
            } else {
                selectedIndices.push(index);
            }
        }

        function moveSelectedToDegree() {
            const degree = parseInt(document.getElementById('moveToDegree').value);
            const today = new Date().toISOString().split('T')[0];
            selectedIndices.forEach(index => {
                characters[index].degree = degree;
                characters[index].nextReview = getNextReviewDate(degree, today);
            });
            saveCharacters();
            displayCharacters(); // This now respects the current display mode
            selectedIndices = [];
            showNotification('Selected characters moved successfully!', 'success');
        }

        function applyBatchProperty() {
            const property = document.getElementById('batchProperty').value;
            if (property) {
                selectedIndices.forEach(index => {
                    characters[index].property = property;
                });
                saveCharacters();
                displayCharacters(); // This now respects the current display mode
                selectedIndices = [];
                showNotification('Property applied to selected characters successfully!', 'success');
            } else {
                showNotification('Please select a property to apply.', 'warning');
            }
        }

        function deleteSelected() {
            characters = characters.filter((_, index) => !selectedIndices.includes(index));
            saveCharacters();
            displayCharacters(); 
            selectedIndices = [];
            showNotification('Selected characters deleted successfully!', 'success');
        }

        function searchCharacters() {
            const searchTerm = document.getElementById('searchCharacters').value.toLowerCase();
            const characterCards = document.querySelectorAll('.character-card');
            characterCards.forEach(card => {
                const character = card.querySelector('.character').textContent.toLowerCase();
                if (character.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            if (tabId === 'reviewTab') {
                displayReviewCharacters();
            } else if (tabId === 'inputTab') {
                displayCharacters();
            }
        }

        function updateSummary() {
            const totalCharacters = characters.length;
            const today = new Date().toISOString().split('T')[0];
            const dueCharacters = characters.filter(char => char.nextReview <= today).length;
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <strong>Total Characters:</strong> ${totalCharacters} | 
                <strong>Due for Review Today:</strong> ${dueCharacters}
            `;
        }

        function exportCharacters() {
            const dataToExport = characters.map(char => ({
                character: char.character,
                degree: char.degree,
                nextReview: char.nextReview,
                lastReviewed: char.lastReviewed,
                property: char.property
            }));
        
            const ws = XLSX.utils.json_to_sheet(dataToExport);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Characters");
            XLSX.writeFile(wb, "chinese_characters_srs.xlsx");
        }

        function importCharacters() {
            const file = document.getElementById('importFile').files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const json = XLSX.utils.sheet_to_json(worksheet);
                
                characters = json.map(row => ({
                    character: row.character,
                    degree: parseInt(row.degree),
                    nextReview: row.nextReview,
                    lastReviewed: row.lastReviewed,
                    property: row.property || '' // Use an empty string if property is undefined
                }));
        
                saveCharacters();
                displayCharacters();
                showNotification('Characters imported successfully!', 'success');
            };
            reader.readAsArrayBuffer(file);
        }

        function clearCharacters() {
            if (confirm('Are you sure you want to clear all characters? This action cannot be undone.')) {
                characters = [];
                saveCharacters();
                displayCharacters();
                showNotification('All characters have been cleared!', 'success');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            notification.className = 'notification ' + type;
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            showTab('reviewTab');
            document.getElementById('importFile').addEventListener('change', importCharacters);
            displayCharacters(); // This will use the default 'degrees' mode on initial load
        });
    </script>
</body>
</html>
